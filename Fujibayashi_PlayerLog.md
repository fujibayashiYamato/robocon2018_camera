# やること
* ~~rosserialの実装~~
  * ~~通信が楽になる~~
  * ~~デバックをするためにstmのプログラムを書く必要がある~~
  * ~~ブランチを分けて復帰できるようにして書く~~
    * ~~sudo apt-get install ros-kinetic-rosserial 完了~~


* ~~文字列の通信を出来るようにする~~
  * ~~今のままだと、改行コードのせいで文字が途切れる~~
  * ~~rosserialを実装しないのであればそこをなんとかする~~
  * ~~しらべよう~~
    * rosserialを実装したため削除


* ~~通信を使った動的なデバック~~
  * ~~実際のロボットの動きをイメージ~~
  * ~~シャトルコックの位置は通信の回数で固定しておく~~
  * ~~ロボットの動きとカメラから見たシャトルコックは同調させる必要がある~~


* ~~実際のデータの保存~~
  * ~~静止画ではなく動画として~~
  * ~~静止画をたくさん~~
  * ~~テキストデータとして時間とデータ名を記録~~


* ~~実際のデータの再生~~
  * ~~テキストデータから時間を抽出する~~
  * ~~テキストデータからファイル名を抽出する~~
  * ~~時間に合わせたデータを表示する~~


* Z1.Z2.Z3の流れでのタスク検知
  * ~~Z1がはいったか？~~
  * ~~Z２がはいったか？~~
  * ~~Z３がはいったか？~~
  * ~~カップに入ったか？~~


* ~~カップに入ったか？~~
  * ~~リングを通った後は空気抵抗での速度の低下が激しい~~
  * ~~リングとカップの判断を別の関数にする~~
    * ~~カップは(1.0-sqrtf(1.0-4.0*geinAir*pointX))/(2.0*geinAir)~~
  * 実際のデータがないと厳しい
  * 時間に比例するものを作ろう
  * 近似した得たabcと着地点xを対応させる
    * サンプルデータを取り、その着地点に近いものを取る
    * 会場で違う動きをした時に対応できない
  * 諸速度と角度を使い、空気抵抗係数を調べる
    * 諸速度と係数、xz値を使い、角度を出す
    * とりあえず、データ取るまで手投げのやつで練習する。
    * t0がわからない


* 自分のシャトルコックか？
  * 前とったデータより後ろなら取らない
  * 軌道予測を動的に行う
    * 一個目と二個目を使い三個目の位置を予測、誤差範囲になければそれは違う点
  * 色


* tfを使った座標変換を行う
  * 座標変換でのミスがなくなる
  * ソースが綺麗になる
  * ブランチを分けて復帰できるようにして書く
    * tfの実装は難しかった（よくわからない）、後回しにする


* ~~tfを使い時間を取得、その値を使った弾道予測の取得~~
  * ~~近似より正確な値の修得が出来る~~
  * ~~必要性は低い~~
  * ~~ブランチを分けて復帰できるようにして書く~~
    * 必要性が皆無なため消去


* ~~リトライ対策をかんがえる~~
  * ~~座標で切り替わる~~
  * ~~マイコンからなにか送る~~


* ノイズの除去
  * 本番何があるかわからないため、もっとノイズ対策する
  * ダウンサンプリングを使う問はサークルノイズ処理は使わない
  * サークルノイズ処理のほうがいい？ダウンサンプリングしなくて良い
  * サークルノイズ処理を使う時のクラスタリングのしきい値を探す
  * しきい値はちゃんと覚えておくようにするメモする
    * 現状問題がないため、とりあえずはこのままで


* ~~リングのあるところだけ四角く切る~~
  * ~~これをすると奥行きのカットが要らなくなる？~~
  * ~~今のままだとTZ1の時に取れる距離が少なくなる~~
  * ~~何故か値移動ができない~~
  * ~~TZ1で実際にやってみる~~


* ~~調整モードを作る~~
  * ~~カメラのy軸角度とz位置~~


* 本番のようなデバック
  * 試作機にジャイロとエンコを搭載
  * それにキネクト載せてプログラムを動かす


* 水銀灯対策
  * 実際にどれくらいノイズが出るか調べる
  * 体育館とか6号館とか
  * 東京に行くのも視野にいれる


* RealSenseD435
  * どのように環境開発するか調べる
  * できるところまでやっておく
  * PCLに接続する方法も


*  ミニPC
  * どのように環境開発するか調べる


* TZ1,TZ2,TZ3から投げたデータの取得
  * デバックする上でほしい
  * できればY角度を固定してほしい


* RosSerial
  * ~~マイコン側のrosserialのクラス名を変更する~~
  * ~~資料をいしっかりと作る必要がある~~
  * ~~シャトルシリアルとか？byかない~~
  * ハンドラーを渡してserialを変更できるようにしたい
  * ~~ボーレートを変更するものを作る~~


* ~~カメラをのせる時の角度がまだ~~
  * ~~20度と25度がほしい~~


* ~~aがプラスの時は値を取らないまたは失敗~~
  * ~~下に凸になる~~
  * ~~ありえない~~


* ~~ros_libの中身を綺麗にする~~


# 行動履歴
## 2018-01-17
* ノイズの除去法を考える  
* 条件の問題か、statisticalOutlierRemovalは良くなかった  
* 次は背景差分と、outlierRemovalをためす  

## 2018/01/19
* radiusOutlierRemovalを試したが重い、つかうのは難しい

## 2018/01/20
* 進捗なし

## 2018/01/21
* 点群の数を減らし、statisticalOutlierRemovalでノイズを消した  
* クラスタリングによるシャトルコックの点群の認識に成功  
* ノイズ除去をradiusOutlierRemovalをつかうにへんこう  

## 2018/01/23
* 比較のプログラムを使った物体検知のプログラムを発見  

## 2018/01/25
* エラーを消去  
* 完璧なり  

## 2018/01/26
* 物体の点群を表示する、または物体を表す点群を取得する  
* 目的は物体を表す点群の確保  

## 2018/01/27
* ｲﾐﾜｶﾗﾝﾃｨｳｽ  

## 2018/01/29
* 特徴点を使った三次元の物体検知のプログラムの描写ができた？  
* キネクトからとった値だとできない？  
* objectのデータを作る  

## 2018/01/30
* パーティクルが持っているデータへのアクセスが成功  
* パーティクルをすべて赤色にしてみた  

## 2018/01/31
* シャトルコックの重心位置の計算と描画ができた  

## 2018/02/01
* 取得した物体の最大半径を調べ、シャトルコックかどうかを判別するプログラムの作成   
* 取得したデータから近似曲線を取得するプログラムの作成  

## 2018/02/02
* 近似曲線の描写  
* ソースの書き直し  
* 点群の角度変更のプログラムの作成  

## 2018/02/10
* リングに通ったかどうかの判別する関数の作成

## 2018/02/21
* rosserialは未実装  
* 値の動的確保は完成（デバック済み）  
* 機体載せて動くかは未定  


## 2018/02/26
* 録画機能を追加


## 2018/02/27
* rosbagの機能を混ぜる
* 録画機能の廃止

## 2018/03/02
* rosserialを使った通信関係のクラス化

## 2018/03/09
* デバック機能搭載
* シャトルコックのデータを点群から取得か既存のデータから取得か切り替え
* 点群の表示の有無の切り替え
* 完成版

## 2018/03/14
* カップに入ったか検知するやつ書いた

## 2018/03/23
* マシンが動かない今！何していいかわからん！わからんわからん！

# memo
シャトルコックを取る方法  
試しに試走場で動かしてみたところ、割としっかりと取れていたため、空間制限とノイズフィルターと使ってみる  

radiusOutlierRemoval重い  
どこまで点群を減らしたらradiusOutlierRemovalがつかえるかしらべる  
radiusOutlierRemovalをつかう  

statisticalOutlierRemovalで大まかにノイズを取って、平面検出を試す。値を帰ると他の形もとっれる。球体はないかな？  
↑きつかった  

球体検知を試みよう  
トラッキングやってみよう  

http://pointclouds.org/documentation/tutorials/correspondence_grouping.php  
を完璧に理解する  
そのためにI/Oを理解する  

fatal error: pcl/filters/uniform_sampling.h  
そんなファイルねえぞエラー　原因模索中  
1.8仕様だった模様  
正解は  
#include <pcl/keypoints/uniform_sampling.h>  
http://www.pcl-users.org/problem-with-cluod-uniform-sampling-header-td4040685.html  

どうすれば表示されるのかわからない  
関数の中ではできているので、表示するクラスを引数に入れてやったぜ  
うまく行った？ビミョ  
単純に知識不足か、何をやっているか調べる必要がある  
調べたけどわからなかったぞ  
先輩に聞くか？まだその時じゃない  
牛乳買いに行こう  
よく見ると画像の更新が行えていない？  
きっついお、これを読んでいる自分よ。がんばれ。  
ｲﾐﾜｶﾗﾝﾃｨｳｽ  
描画に関する基礎知識が足りないね、関数ではなくメインのほうで一度使ってみるのがベスト  

点群データ更新キタコレ  
物体検知、動いた？  
探す点群をキネクトのとったものにするとダメ  
なにがだめ？  
単純に物体を検知しない  
たまい赤くなる時がある（に人間が写った時とか）（複雑なものが写った時。。。ノイズ？）  
その赤いやつ消えない、一回赤くなるとそのまま  
ｲﾐﾜｶﾗﾝﾃｨｳｽ  

わかりあせん。とりあえず中断   
他の検知方法探すかなぁ  
小原先輩に泣きつく  
色検知はしたくないなあ  
あああああああああああああああああああああああ  
小原先輩神  
天使  
多分出来たかな  
保存したPCLデータだとできるんだけどキネクトのデータだとできない  
よくわかんないからobjectデータを作るか  

objectのデータを作る  
そのためにまず色でダウンサンプリング  
背景差分  

背景差分やっぱわかんない  
なくてもできないことはないから、空中に物体を浮かせてデータを取る。  

物体検知  
プログラムは問題なさそう  
ただ、一致率（その物体らしさ）が高くないとはんのうしない  
それを下げる方法を探す  
無理  

とりあえず  
空間区切り  
ダウンサンプリング  
クラスタリング   
でどこまで行けるか試す  
店の数じゃなくて（店の数もだけど）　大きさとか半径とかも使ってみよう  

シャトルコック以外を取らないように、重心位置から一番遠い点までの距離でフィルターをかける。  
もっとしっかりとシャトルコックを取るようにする。  
できたかな？  

距離で区切る奴だけどリングのところだけ見ないようにしたらどうです？  
今後やる予定にします  

重心位置を保存する  
弾道予測しよう  
二次関数のabcの計算はできた  

くらくなるとノイズの量が変わる（注意）    
ノイズ除去するフィルターなんとかしたい

abcのあたいがでない  
はじめから動きを確認していく  
ヴェクターあたりが怪しい  
かいけつ  

途中まで直線、途中から曲線  

角度と座標を変更するプログラムを作成する  

タスク判断の関数を作る  

二次関数の式の回転と移動  

データを取るときにとったデータの回転と移動を済ませた状態で近似することでややこしい式が要らなくなるのでは？一通りで来たら試す。まずは完成させることを目指す。  

角度はダメ  

綺麗な放物線はいいが空気抵抗をもろに受けているような放物線は精度が悪い。近似では限界がある？  
暗くなると（照明が強くなる）ノイズが多くなるためノイズ除去を考える。  
ちゃんとした重心位置を出す。  
通信を考える。  
  受信　「x,y,θ」ロボットの座標と角度。zは定数（=0）なのでいらない  
  送信　「y,z」リングからどのくらいずれているか、入った場合は「0,0」   
  4バイト  
  踏んだパソコンから引っ張ってくる  
角度計算（だいたい25度？）  

opencvのほう、0の角度を渡すとき、たぶん値の初期化ができていない、オーバーフローとする  
ｐｃｌのほう、ゴールの時は０．０を渡すはずなのに外した時の値が出る、たぶんstrを初期化しなければいけない  
とったデータをすぐに絶対的なものに変換をしないと、ロボットが動いた時に対処できない  

pcl:値が更新されない現象  
	1バイト目が00000000だと起こる現象  
	とりあえず場合分けで対処  
pcl:受信したが送信せずもう一度受信する現象  
	多分値が00001101(\r)になっている  
	キムタクに聞く  
opencv:受信した値がオーバーフロートしている  
	未解決、原因不明  

rosserialというものがある

serial_test01のserial.hppを改造中
並行してrosserialの実装も企んでいる


キムタクにはxyθを引数に入れてあげるだけの関数を渡す
rosserialを使えるようにする
tfを使えるようにする
まずはfloat3つを通信するようにする

rosserial.hppの中身を書き換えることで、serial0とボーレートを変更できる

なにすればいいかわからなくなった
ロボウィキの更新
rosserialのserialを引数とかで変更できるようにする
カップに乗ったかの精度向上（ロボットに乗せてから）
jetsonTX1でうごかしてみる
通信の確認
